/**
 * Mermaid Diagram Styles
 * Theming and modal styles for mermaid diagrams
 */

/* ========== BASE STYLES ========== */

.mermaid {
  background: var(--bg-secondary);
  padding: 1rem;
  border-radius: var(--radius-md);
  text-align: center;
  opacity: 0;
  transition: opacity 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
}

.mermaid[data-processed="true"] {
  opacity: 1;
  cursor: zoom-in;
}

.mermaid[data-processed="true"]:hover {
  transform: scale(1.02);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

/* ========== SVG THEMING ========== */
/* Unified control over all mermaid SVG elements.
   Uses mode-only --mermaid-* vars (NOT palette) for consistent diagrams.
   :is() scopes both inline and modal diagrams in one pass. */

:is(.mermaid, .mermaid-modal-diagram) svg {
  font-family: var(--font-code) !important;
  font-size: 13px !important;
}

/* --- Typography: all text inside SVG --- */
:is(.mermaid, .mermaid-modal-diagram) svg .nodeLabel,
:is(.mermaid, .mermaid-modal-diagram) svg .nodeLabel p,
:is(.mermaid, .mermaid-modal-diagram) svg .label,
:is(.mermaid, .mermaid-modal-diagram) svg .label div,
:is(.mermaid, .mermaid-modal-diagram) svg foreignObject div {
  font-family: var(--font-code) !important;
  line-height: 1.4 !important;
}

/* --- Nodes: rect, polygon, circle shapes --- */
:is(.mermaid, .mermaid-modal-diagram) svg .node rect,
:is(.mermaid, .mermaid-modal-diagram) svg .node polygon,
:is(.mermaid, .mermaid-modal-diagram) svg .node circle,
:is(.mermaid, .mermaid-modal-diagram) svg .node .label-container {
  fill: var(--mermaid-node-bg) !important;
  stroke: var(--mermaid-node-border) !important;
  stroke-width: 1.5px !important;
  rx: 4;
  ry: 4;
}

/* --- Node labels --- */
:is(.mermaid, .mermaid-modal-diagram) svg .node .nodeLabel,
:is(.mermaid, .mermaid-modal-diagram) svg .node .nodeLabel p,
:is(.mermaid, .mermaid-modal-diagram) svg .node .nodeLabel span {
  color: var(--mermaid-node-text) !important;
  fill: var(--mermaid-node-text) !important;
  font-size: 12px !important;
}

/* --- Edges: lines + arrows --- */
:is(.mermaid, .mermaid-modal-diagram) svg .edgePath path {
  stroke: var(--mermaid-edge) !important;
  stroke-width: 1.5px !important;
}

:is(.mermaid, .mermaid-modal-diagram) svg marker path {
  fill: var(--mermaid-edge) !important;
  stroke: var(--mermaid-edge) !important;
}

/* --- Edge labels --- */
:is(.mermaid, .mermaid-modal-diagram) svg .edgeLabel {
  font-size: 11px !important;
}

:is(.mermaid, .mermaid-modal-diagram) svg .edgeLabel,
:is(.mermaid, .mermaid-modal-diagram) svg .edgeLabel p,
:is(.mermaid, .mermaid-modal-diagram) svg .edgeLabel rect,
:is(.mermaid, .mermaid-modal-diagram) svg .edgeLabel .labelBkg {
  background-color: var(--bg-secondary) !important;
  fill: var(--bg-secondary) !important;
  color: var(--text-muted) !important;
}

/* --- Clusters / subgraphs --- */
:is(.mermaid, .mermaid-modal-diagram) svg .cluster rect {
  fill: color-mix(in srgb, var(--mermaid-node-bg) 20%, var(--bg)) !important;
  stroke: var(--mermaid-node-border) !important;
  stroke-width: 1px !important;
  stroke-dasharray: 4 3 !important;
  rx: 6;
  ry: 6;
}

:is(.mermaid, .mermaid-modal-diagram) svg .cluster-label .nodeLabel {
  color: var(--text-muted) !important;
  font-weight: 600;
  font-size: 11px !important;
  letter-spacing: 0.03em;
  text-transform: uppercase;
}

/* --- Title --- */
:is(.mermaid, .mermaid-modal-diagram) svg .titleText {
  fill: var(--mermaid-node-text) !important;
  font-size: 14px !important;
  font-weight: 600;
}

/* ========== SEQUENCE DIAGRAM OVERRIDES ========== */

/* --- Actor boxes (participants) --- */
:is(.mermaid, .mermaid-modal-diagram) svg .actor {
  fill: var(--mermaid-node-bg) !important;
  stroke: var(--mermaid-node-border) !important;
}

:is(.mermaid, .mermaid-modal-diagram) svg text.actor > tspan,
:is(.mermaid, .mermaid-modal-diagram) svg .actor-box {
  fill: var(--mermaid-node-text) !important;
}

/* --- Actor lifelines --- */
:is(.mermaid, .mermaid-modal-diagram) svg .actor-line {
  stroke: var(--mermaid-edge) !important;
}

/* --- Message lines (solid + dashed) --- */
:is(.mermaid, .mermaid-modal-diagram) svg .messageLine0,
:is(.mermaid, .mermaid-modal-diagram) svg .messageLine1 {
  stroke: var(--text) !important;
}

/* --- Message text --- */
:is(.mermaid, .mermaid-modal-diagram) svg .messageText {
  fill: var(--text) !important;
}

/* --- Arrow markers --- */
:is(.mermaid, .mermaid-modal-diagram) svg #arrowhead path {
  fill: var(--text) !important;
  stroke: var(--text) !important;
}

:is(.mermaid, .mermaid-modal-diagram) svg #crosshead path {
  fill: var(--text) !important;
  stroke: var(--text) !important;
}

/* --- Loop/alt/opt boxes --- */
:is(.mermaid, .mermaid-modal-diagram) svg .loopLine {
  stroke: var(--mermaid-node-border) !important;
  fill: var(--mermaid-node-bg) !important;
}

:is(.mermaid, .mermaid-modal-diagram) svg .loopText,
:is(.mermaid, .mermaid-modal-diagram) svg .loopText > tspan {
  fill: var(--text) !important;
}

/* --- Labels --- */
:is(.mermaid, .mermaid-modal-diagram) svg .labelBox {
  fill: var(--mermaid-node-bg) !important;
  stroke: var(--mermaid-node-border) !important;
}

:is(.mermaid, .mermaid-modal-diagram) svg .labelText,
:is(.mermaid, .mermaid-modal-diagram) svg .labelText > tspan {
  fill: var(--mermaid-node-text) !important;
}

/* --- Notes --- */
:is(.mermaid, .mermaid-modal-diagram) svg .note {
  fill: var(--bg-secondary) !important;
  stroke: var(--mermaid-node-border) !important;
}

:is(.mermaid, .mermaid-modal-diagram) svg .noteText,
:is(.mermaid, .mermaid-modal-diagram) svg .noteText > tspan {
  fill: var(--text) !important;
}

/* --- Activation bars --- */
:is(.mermaid, .mermaid-modal-diagram) svg .activation0,
:is(.mermaid, .mermaid-modal-diagram) svg .activation1,
:is(.mermaid, .mermaid-modal-diagram) svg .activation2 {
  fill: var(--bg-secondary) !important;
  stroke: var(--mermaid-node-border) !important;
}

/* ========== MODAL ========== */

#mermaid-modal {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 9999;
  align-items: center;
  justify-content: center;
}

#mermaid-modal.open {
  display: flex;
}

.mermaid-modal-backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(4px);
}

.mermaid-modal-content {
  position: relative;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 2rem;
}

.mermaid-modal-close {
  position: absolute;
  top: 0.5rem;
  right: 0.75rem;
  background: none;
  border: none;
  font-size: 1.5rem;
  color: var(--text-muted);
  cursor: pointer;
  padding: 0.25rem 0.5rem;
  line-height: 1;
  transition: color 0.2s;
  z-index: 1;
}

.mermaid-modal-close:hover {
  color: var(--text);
}

.mermaid-modal-diagram {
  display: flex;
  align-items: center;
  justify-content: center;
}
